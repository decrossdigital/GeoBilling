# üöÄ Deployment Guide - GeoBilling to Render.com

This guide will walk you through deploying your GeoBilling application to Render.com.

## üìã Prerequisites

1. **GitHub Repository**: Your code should be pushed to GitHub
2. **Render.com Account**: Sign up at [render.com](https://render.com)
3. **Environment Variables**: Prepare your API keys and secrets

## üîß Step 1: Prepare Environment Variables

Before deploying, you'll need these environment variables:

### **Required Variables**
- `DATABASE_URL` - Will be provided by Render PostgreSQL (manual setup)
- `NEXTAUTH_URL` - Your Render app URL (e.g., `https://geobilling-app.onrender.com`)
- `NEXTAUTH_SECRET` - Will be generated by Render
- `GOOGLE_CLIENT_ID` - Your Google OAuth client ID
- `GOOGLE_CLIENT_SECRET` - Your Google OAuth client secret
- `STRIPE_PUBLISHABLE_KEY` - Your Stripe publishable key
- `STRIPE_SECRET_KEY` - Your Stripe secret key
- `RESEND_API_KEY` - Your Resend.com API key

### **Optional Variables**
- `PAYPAL_CLIENT_ID` - PayPal client ID
- `PAYPAL_CLIENT_SECRET` - PayPal client secret
- `FROM_EMAIL` - Email address for sending notifications

## üåê Step 2: Deploy to Render.com

### **Option A: Using render.yaml (Simplified)**

1. **Push to GitHub**: Make sure your code is on GitHub
2. **Connect to Render**: 
   - Go to [render.com](https://render.com)
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing `render.yaml`
3. **Deploy**: Render will automatically create the web service
4. **Create Database Manually**: See Step 2.1 below

### **Option B: Manual Deployment (Recommended)**

#### **2.1 Create PostgreSQL Database**
1. Go to [render.com](https://render.com)
2. Click "New +" ‚Üí "PostgreSQL"
3. Configure:
   - **Name**: `geobilling-db`
   - **Database**: `geobilling`
   - **User**: `geobilling`
   - **Region**: Choose closest to you
   - **Plan**: Free (or paid for production)
4. Click "Create Database"
5. Copy the **Internal Database URL** (you'll need this later)

#### **2.2 Create Web Service**
1. Click "New +" ‚Üí "Web Service"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `geobilling-app`
   - **Environment**: `Node`
   - **Region**: Same as database
   - **Branch**: `main`
   - **Build Command**: `npm install && npx prisma generate && npm run build`
   - **Start Command**: `npx prisma db push && npm start`
   - **Plan**: Free (or paid for production)

#### **2.3 Configure Environment Variables**
In your web service settings, add these environment variables:

```
DATABASE_URL=<your-postgresql-internal-url>
NEXTAUTH_URL=https://your-app-name.onrender.com
NEXTAUTH_SECRET=<generate-a-secure-random-string>
GOOGLE_CLIENT_ID=<your-google-client-id>
GOOGLE_CLIENT_SECRET=<your-google-client-secret>
STRIPE_PUBLISHABLE_KEY=<your-stripe-publishable-key>
STRIPE_SECRET_KEY=<your-stripe-secret-key>
RESEND_API_KEY=<your-resend-api-key>
NODE_ENV=production
```

## üîê Step 3: Configure OAuth Providers

### **Google OAuth Setup**
1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a new project or select existing
3. Enable Google+ API
4. Create OAuth 2.0 credentials
5. Add authorized redirect URIs:
   - `https://your-app-name.onrender.com/api/auth/callback/google`
6. Copy Client ID and Client Secret to Render environment variables

### **Stripe Setup**
1. Go to [Stripe Dashboard](https://dashboard.stripe.com)
2. Get your API keys (publishable and secret)
3. Add them to Render environment variables
4. Configure webhook endpoints if needed

### **Resend.com Setup**
1. Sign up at [resend.com](https://resend.com)
2. Get your API key
3. Add to Render environment variables

## üöÄ Step 4: Deploy and Test

1. **Trigger Deployment**: Render will automatically deploy when you push to GitHub
2. **Monitor Logs**: Check the deployment logs for any errors
3. **Test Application**: Visit your app URL and test all features
4. **Database Migration**: The app will automatically run Prisma migrations

## üîß Step 5: Post-Deployment Setup

### **Database Seeding**
If you need to seed the database with initial data:

1. Go to your web service on Render
2. Click "Shell"
3. Run: `npm run db:seed`

### **Custom Domain (Optional)**
1. In your web service settings, go to "Custom Domains"
2. Add your domain
3. Configure DNS records as instructed

## üìä Monitoring and Maintenance

### **Health Checks**
- Render automatically monitors your app
- Set up custom health check endpoints if needed

### **Logs**
- View logs in the Render dashboard
- Set up log aggregation for production

### **Scaling**
- Upgrade to paid plans for better performance
- Configure auto-scaling rules

## üõ†Ô∏è Troubleshooting

### **Common Issues**

1. **Build Failures**
   - Check build logs for missing dependencies
   - Ensure all environment variables are set

2. **Database Connection Issues**
   - Verify DATABASE_URL is correct
   - Check if database is accessible from web service

3. **OAuth Errors**
   - Verify redirect URIs are correct
   - Check environment variables

4. **Payment Processing Issues**
   - Ensure Stripe keys are correct
   - Check webhook configurations

### **Useful Commands**
```bash
# Check deployment status
curl https://your-app-name.onrender.com/health

# View logs
# Use Render dashboard or CLI

# Database operations
npx prisma db push
npx prisma studio
```

## üîí Security Considerations

1. **Environment Variables**: Never commit secrets to Git
2. **HTTPS**: Render provides SSL certificates automatically
3. **Database**: Use strong passwords and restrict access
4. **OAuth**: Configure proper redirect URIs
5. **API Keys**: Rotate keys regularly

## üìà Performance Optimization

1. **Caching**: Implement Redis for session storage
2. **CDN**: Use Cloudflare or similar for static assets
3. **Database**: Optimize queries and add indexes
4. **Images**: Use image optimization services

## üéâ Success!

Your GeoBilling application is now deployed and accessible at:
`https://your-app-name.onrender.com`

## üìû Support

- **Render Documentation**: [docs.render.com](https://docs.render.com)
- **Next.js Documentation**: [nextjs.org/docs](https://nextjs.org/docs)
- **Prisma Documentation**: [prisma.io/docs](https://prisma.io/docs)
